什么是高可用性？
高可用性: High Availability (简称 HA)
可用性 (Availability) = 可靠性 (Reliability) + 可维护性 (Maintainability)
自动检测、自动切换、自动恢复
主从方式、互备方式、集群方式



集群的三大核心概念
集群 (Cluster)
节点 (Node)
服务 (Service)




机房的网络质量评估
机房的网络质量可以参考下面3 个标准：
1 ） 稳定性。响应延迟，丢包率。测试方法：长时间的ping 测试。测试工具有smokeping
、mtr 、ping2 。
2 ）带宽质量。测试TCP 的下载速度以及最大TCP 的下载速率。测试方法： ge t/ 其他
下载测试。测试工具有webbench I iperf，也可使用云测试平台。
3 ）接入位置。接入路由设备离骨干网的位置，接入条数越少越好。测试方法：路由跟
踪。测试工具有mtr/tracert 等。



服务器运行什么应用

负载均衡端：除了网卡性能以外，它在其他方面对服务器的要求都比较低。如果选
用LVS 负载均衡方案，它会直接将所有的连接要求转给后端的Web 应用服务器，
建议选用万兆网卡；如果选用HAproxy 负载均衡器，由于它的运行机制跟LVS 不
一样，流量必须双向经过HAproxy 机器本身，因此会对CPU 的运行能力有所要
求，建议选用万兆网卡；

缓存服务器：主要是Varnish 和redis ，对CPU 及其他方面的性能要求一般，但在
内存方面的要求较多。笔者曾为了保证预算，在双核（ r3.large ）机器上运行了4 个
red is 实例， AWS 官方也建议将此内存优化型实例用于高性能数据库、分布式内存
缓存、内存中分析、基因组装配和分析，以及SAP, Microsoft SharePoint 和其他企
业应用程序的较大部署。

应用服务器：因为它承担了计算和功能实现的重任，所以需要为基于Web 架构的应
用程序服务器（ Application Server ）选择足够快的服务器，另外，应用程序服务器
可能需要用到大量的内存，尤其是基于Windows 基础架构的Ruby 、Python 、Java
服务器，这一类服务器至少需要使用单路至强的配置;至于可靠性问题，如果你的架构中只有一台应用服务
器，那肯定需要这台服务器足够可靠，此时RAID 是绝对不能忽视的选项。但如果
有多台应用服务器并设计了负载均衡机制，那么便拥有了冗余功能，那就不必过于
担心上述问题了。


特殊应用：除了用于Web 架构中的应用程序以外，如果你的服务器还要处理流媒体
视频编码、服务器虚拟化、媒体服务器，或者作为游戏服务器（逻辑、地图、聊天
等）运行，那同样会对CPU 和内存有一定的要求，至少要考虑四核以上的服务器。

公共服务：这里指的是邮件服务器、文件服务器、DNS 服务器、域控服务器等。通
常我们会部署两台DNS 服务器互相备份，域控主服务器也会拥有一台备份服务器;邮件服务器至少需要具备
足够的硬件可靠性和容量大小，这主要是对邮件数据负责，因为很多用户没有保存
和归档邮件数据的习惯，待其重装系统后，就会习惯性地到服务器上重新下载相应
的数据。至于性能问题，应该评估用户数量后再决定。

数据库服务器：数据库对服务器的要求是最高的，也最重要的。一般情况下，无
论你使用的是MySQL 、SQLServer 还是Oralee ，它都需要有足够快的CPU 、足够
大的内存、足够稳定可靠的硬件。


RabbitMQ 集群： Rabb it 消息中间件是基于Er lang 语言开发的，对内存的要求很
高。

Hadoop 和Spark 分布式计算：拥有
高频率处理器、高达48TB 的HDD 本地存储、高
磁盘吞吐量.








常见应用环境下的内存配置建议：
口无论是Apache 或Nginx 服务器，一般情况下Web 前端服务器不需要配置特别高的
内存，尤其是在集群架构中， 4GB 的内存就已经足够了。如果用户数量持续增加，
我们才会考虑使用8GB 或更高的内存。单Apache Web 机器，在配置了16GB 内存
后，可以抗6000 个并发链接数。
口对于运行Tomcat 、Resin 、Web Logic 的应用服务器， 8GB 内存应该是基准配置，更
准确的数字需要根据用户数量和技术架构来确定。
口数据库服务器的内存由数据库实例的数量、表大小、索引、用户数等决定， 一般
建议配置16GB 以上的内存， 笔者公司在许多项目方案中使用了24GB ～ 48GB 的
内存。
口诸如Postfix 和Exchange 这样的邮件服务器对内存的要求并不高， lGB ～ 2GB 就可
以满足了。
口还有一些特殊的服务器，需要为之配置尽可能高的内存容量，比如配置有Varn ish
和Memcached 的缓存服务器等。
口若是只有一台文件服务器， lGB 的内存可能就足够了。



需要怎样的硬盘存储系统:
口如果是用做缓存服务器，比如Varnish 或Red is ，可以考虑用RAID O;
口如果是跑N ginx+ F astCGI 或Nginx 等应用，可以考虑用RAID 1;
口如果是内网开发服务器或存放重要代码的服务器，可以考虑用RAID 5;
口如果是跑MySQL 或Oracle 等数据库应用，可以考虑用固态硬盘做RAID 5 或
RAID 10 。



口 RAID O ：通过把多块硬盘粘合成一个容量更大的硬盘组，提高了磁盘的性能和吞吐
量； 这种方式成本低，要求至少两个磁盘，但是没有容错和数据修复功能， 因而只
能用在对数据安全性要求不高的环境中。
口 RAID l ：也就是磁盘镜像，通过把一个磁盘的数据镜像到另一个磁盘上，最大限度
地保证磁盘数据的可靠性和可修复性，具有很高的数据冗余能力，但磁盘利用率只
有50% ，因而成本最高，多用在保存重要数据的场合。
口RAID 5 ：采用了磁盘分段加奇偶校验技术，从而提高了系统可靠性， RAIDS 读出
效率很高，写入效率一般，至少需要3 块盘。允许一块磁盘故障，而不影响数据的
可用性。
口RAID 10 ：把队ID 1 和RAID O 技术结合起来就成了RAID 10 ，至少需要4 个硬
盘。此种方式的数据除分布在多个盘上外，每个盘都有其镜像盘，提供全冗余能
力，同时允许一个磁盘故障，而不影响数据可用性，并具有快速读／写能力。


